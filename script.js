// Island Scanner Pokemon data for Ultra Sun/Moon
const ultraSunMoonData = {
  monday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 12, id: 7 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 19, id: 363 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 33, id: 220 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 57, id: 306 }] },
  ],
  tuesday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 14, id: 95 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 20, id: 256 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 35, id: 394 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 61, id: 479 }] },
  ],
  wednesday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 18, id: 116 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 24, id: 679 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 36, id: 388 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 57, id: 542 }] },
  ],
  thursday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 9, id: 664 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 14, id: 15 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 29, id: 18 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 45, id: 652 }] },
  ],
  friday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 10, id: 1 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 16, id: 253 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 29, id: 391 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 44, id: 658 }] },
  ],
  saturday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 9, id: 607 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 17, id: 259 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 30, id: 610 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 44, id: 655 }] },
  ],
  sunday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 12, id: 4 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 17, id: 280 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 32, id: 111 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 55, id: 604 }] },
  ],
};

// Island Scanner Pokemon data for original Sun/Moon
const sunMoonData = {
  monday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 12, id: 158 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 19, id: 363 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 31, id: 220 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 57, id: 534 }] },
  ],
  tuesday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 13, id: 633 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 20, id: 404 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 33, id: 578 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 59, id: 468 }] },
  ],
  wednesday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 18, id: 116 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 23, id: 679 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 34, id: 315 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 57, id: 542 }] },
  ],
  thursday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 8, id: 599 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 14, id: 543 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 27, id: 397 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 43, id: 497 }] },
  ],
  friday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 10, id: 152 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 16, id: 69 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 27, id: 288 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 43, id: 503 }] },
  ],
  saturday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 10, id: 607 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 17, id: 183 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 28, id: 610 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 43, id: 500 }] },
  ],
  sunday: [
    { island: "üèùÔ∏è Mele-Mele", pokemon: [{ level: 12, id: 155 }] },
    { island: "üå∫ Akala", pokemon: [{ level: 17, id: 574 }] },
    { island: "üåã Ula-Ula", pokemon: [{ level: 30, id: 111 }] },
    { island: "üèîÔ∏è Poni", pokemon: [{ level: 55, id: 604 }] },
  ],
};

// Daily location rotation data
const dailyLocations = {
  monday: [
    { island: "üèùÔ∏è Mele-Mele", location: "Meeresh√∂hle" },
    { island: "üå∫ Akala", location: "Route 7" },
    { island: "üåã Ula-Ula", location: "Dorf der Kapu" },
    { island: "üèîÔ∏è Poni", location: "Ebene von Poni" },
  ],
  tuesday: [
    { island: "üèùÔ∏è Mele-Mele", location: "Tenkarat-H√ºgel" },
    { island: "üå∫ Akala", location: "Route 8" },
    { island: "üåã Ula-Ula", location: "Route 16" },
    { island: "üèîÔ∏è Poni", location: "Beschwerlicher Pfad" },
  ],
  wednesday: [
    { island: "üèùÔ∏è Mele-Mele", location: "Kala'e-Bucht" },
    { island: "üå∫ Akala", location: "Akala-K√ºstenstreifen" },
    { island: "üåã Ula-Ula", location: "Ula-Ula-Blumenmeer" },
    { island: "üèîÔ∏è Poni", location: "Poni-Blumenmeer" },
  ],
  thursday: [
    { island: "üèùÔ∏è Mele-Mele", location: "Hauholi City" },
    { island: "üå∫ Akala", location: "Route 4" },
    { island: "üåã Ula-Ula", location: "Route 10" },
    { island: "üèîÔ∏è Poni", location: "Kokowei-Eiland" },
  ],
  friday: [
    { island: "üèùÔ∏è Mele-Mele", location: "Route 2" },
    { island: "üå∫ Akala", location: "Route 5" },
    { island: "üåã Ula-Ula", location: "Route 11" },
    { island: "üèîÔ∏è Poni", location: "Wildnis von Poni" },
  ],
  saturday: [
    { island: "üèùÔ∏è Mele-Mele", location: "Hauholi-Friedhof" },
    { island: "üå∫ Akala", location: "Pl√§tscherh√ºgel" },
    { island: "üåã Ula-Ula", location: "Hokulani-Berg" },
    { island: "üèîÔ∏è Poni", location: "Alter Pfad von Poni" },
  ],
  sunday: [
    { island: "üèùÔ∏è Mele-Mele", location: "Route 3" },
    { island: "üå∫ Akala", location: "Route 6" },
    { island: "üåã Ula-Ula", location: "Gl√ºhberg" },
    { island: "üèîÔ∏è Poni", location: "Wald von Poni" },
  ],
};

// Current game version
let currentVersion = "ultra";
// Function to get Pokemon image URL from PokeAPI
function getPokemonImageUrl(pokemonId) {
  // Using official artwork - high quality images
  return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokemonId}.png`;
}

// Cache for Pokemon data to avoid repeated API requests
const pokemonCache = new Map();

// Function to fetch Pokemon name from PokeAPI
async function getPokemonName(pokemonId) {
  // Check cache first
  if (pokemonCache.has(pokemonId)) {
    return pokemonCache.get(pokemonId);
  }

  try {
    const response = await fetch(
      `https://pokeapi.co/api/v2/pokemon-species/${pokemonId}`
    );
    const data = await response.json();

    // Get German name if available, fallback to English
    const germanName = data.names.find((name) => name.language.name === "de");
    const englishName = data.names.find((name) => name.language.name === "en");
    const pokemonName =
      germanName?.name || englishName?.name || `Pokemon #${pokemonId}`;

    // Cache the result
    pokemonCache.set(pokemonId, pokemonName);
    return pokemonName;
  } catch (error) {
    console.warn(`Failed to fetch name for Pokemon ${pokemonId}:`, error);
    // Return a fallback name
    const fallbackName = `Pokemon #${pokemonId}`;
    pokemonCache.set(pokemonId, fallbackName);
    return fallbackName;
  }
}
const dayNames = {
  de: [
    "Sonntag",
    "Montag",
    "Dienstag",
    "Mittwoch",
    "Donnerstag",
    "Freitag",
    "Samstag",
  ],
  en: [
    "sunday",
    "monday",
    "tuesday",
    "wednesday",
    "thursday",
    "friday",
    "saturday",
  ],
};

const monthNames = {
  de: [
    "Januar",
    "Februar",
    "M√§rz",
    "April",
    "Mai",
    "Juni",
    "Juli",
    "August",
    "September",
    "Oktober",
    "November",
    "Dezember",
  ],
};

function getCurrentDay() {
  const today = new Date();
  const dayIndex = today.getDay();
  return {
    name: dayNames.de[dayIndex],
    key: dayNames.en[dayIndex],
    date: today,
  };
}

function formatDate(date) {
  const day = date.getDate();
  const month = monthNames.de[date.getMonth()];
  const year = date.getFullYear();
  return `${day}. ${month} ${year}`;
}

async function createPokemonCard(islandData, locationData) {
  const card = document.createElement("div");
  card.className = "pokemon-card";

  // Create loading state first
  card.innerHTML = `
    <h3>${islandData.island}</h3>
    <div class="location-info">
      <span class="location-label">üìç ${locationData.location}</span>
    </div>
    <ul class="pokemon-list">
      ${islandData.pokemon
        .map(
          (pokemon) => `
        <li>
          <div class="pokemon-info">
            <img src="${getPokemonImageUrl(
              pokemon.id
            )}" alt="Loading..." class="pokemon-image" loading="lazy" onerror="this.style.display='none'">
            <div class="pokemon-details">
              <span class="pokemon-name">Lade...</span>
              <span class="pokemon-level">Lv. ${pokemon.level}</span>
            </div>
          </div>
        </li>
      `
        )
        .join("")}
    </ul>
  `;

  // Fetch Pokemon names asynchronously and update
  const pokemonItems = card.querySelectorAll(".pokemon-list li");

  islandData.pokemon.forEach(async (pokemon, index) => {
    try {
      const pokemonName = await getPokemonName(pokemon.id);
      const nameElement = pokemonItems[index].querySelector(".pokemon-name");
      const imageElement = pokemonItems[index].querySelector(".pokemon-image");

      if (nameElement) {
        nameElement.textContent = pokemonName;
        nameElement.classList.add("loaded");
      }
      if (imageElement) {
        imageElement.alt = pokemonName;
      }
    } catch (error) {
      console.warn(`Failed to load Pokemon ${pokemon.id}:`, error);
      const nameElement = pokemonItems[index].querySelector(".pokemon-name");
      if (nameElement) {
        nameElement.textContent = `Pokemon #${pokemon.id}`;
        nameElement.classList.add("loaded");
      }
    }
  });

  return card;
}

// Function to display today's locations
function displayTodaysLocations() {
  const currentDay = getCurrentDay();
  const todaysLocations = dailyLocations[currentDay.key];

  const islandsGrid = document.getElementById("islands-grid");
  islandsGrid.innerHTML = "";

  todaysLocations.forEach((locationData) => {
    const island = document.createElement("div");
    island.className = "island";
    island.innerHTML = `
      <strong>${locationData.island}</strong>
      <span>${locationData.location}</span>
    `;
    islandsGrid.appendChild(island);
  });
}

async function displayTodaysPokemon() {
  const currentDay = getCurrentDay();
  const gameData = currentVersion === "ultra" ? ultraSunMoonData : sunMoonData;
  const todaysPokemon = gameData[currentDay.key];
  const todaysLocations = dailyLocations[currentDay.key];

  // Update date display
  document.getElementById("current-day").textContent = currentDay.name;
  document.getElementById("current-date").textContent = formatDate(
    currentDay.date
  );

  // Update footer text
  const footerText =
    currentVersion === "ultra"
      ? "Daten f√ºr Pok√©mon Ultra Sonne & Ultra Mond"
      : "Daten f√ºr Pok√©mon Sonne & Mond";
  document.getElementById("footer-text").textContent = footerText;

  // Display Pokemon cards
  const pokemonGrid = document.getElementById("pokemon-grid");
  pokemonGrid.innerHTML = "";

  // Create all cards with both Pokemon and location data
  for (let i = 0; i < todaysPokemon.length; i++) {
    const card = await createPokemonCard(todaysPokemon[i], todaysLocations[i]);
    pokemonGrid.appendChild(card);
  }
}

// Add some animation effects
function addScrollAnimation() {
  const cards = document.querySelectorAll(".pokemon-card");

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry, index) => {
      if (entry.isIntersecting) {
        setTimeout(() => {
          entry.target.style.opacity = "1";
          entry.target.style.transform = "translateY(0)";
        }, index * 100);
      }
    });
  });

  cards.forEach((card) => {
    card.style.opacity = "0";
    card.style.transform = "translateY(20px)";
    card.style.transition = "opacity 0.6s ease, transform 0.6s ease";
    observer.observe(card);
  });
}

// Version switching
function switchVersion(version) {
  currentVersion = version;

  // Update active tab
  document.querySelectorAll(".version-tab").forEach((tab) => {
    tab.classList.remove("active");
  });
  document.querySelector(`[data-version="${version}"]`).classList.add("active");

  // Update display
  displayTodaysPokemon();
  setTimeout(addScrollAnimation, 100);
}

// Initialize the app
document.addEventListener("DOMContentLoaded", () => {
  displayTodaysPokemon();
  setTimeout(addScrollAnimation, 100);

  // Add event listeners for version tabs
  document.querySelectorAll(".version-tab").forEach((tab) => {
    tab.addEventListener("click", (e) => {
      const version = e.target.dataset.version;
      switchVersion(version);
    });
  });
});

// Update every minute to handle day changes
setInterval(async () => {
  const now = new Date();
  if (now.getHours() === 0 && now.getMinutes() === 0) {
    await displayTodaysPokemon();
  }
}, 60000);
